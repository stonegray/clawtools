# Respec Review — 04 Connector System

Source of truth: `openclaw/` (current workspace).

## Discrepancies

### Provider registration is external
- Respec attributes provider registration to `@mariozechner/pi-ai` (external library).
- OpenClaw invokes `ensureOpenClawModelsJson()` which calls `resolveImplicitProviders()` and merges with explicit config, but does not directly call `registerApiProvider()` from the library.
  - The actual provider/model discovery is driven by OpenClaw's own `models-config.ts` and `model.ts` modules, not internal provider registration.
- Respec should clarify that provider setup in OpenClaw is config-driven (models.json + inline config), not SDK-driven registration.

### Default provider/model constants location
- Respec claims defaults are "DEFAULT_PROVIDER = 'anthropic'; DEFAULT_MODEL = 'claude-opus-4-6'; DEFAULT_CONTEXT_TOKENS = 200_000".
- In OpenClaw, these are defined in `openclaw/src/agents/defaults.js` (imported by `pi-embedded-runner/run.ts`). Verify the exact values match, as they may have changed since respec was written.

### Model descriptor doesn't match exact OpenClaw field structure
- Respec lists a comprehensive `Model<TApi>` interface with `id`, `name`, `api`, `provider`, `baseUrl`, `reasoning`, `input`, `cost`, `contextWindow`, `maxTokens`, `headers`, `compat`.
- OpenClaw's model resolution in `pi-embedded-runner/run/model.ts` loads from `models.json`, which is generated by `models-config.ts`.
  - The field set and structure may differ from Respec's idealized interface; Respec should reference actual model loading logic, not the theoretical interface.

### Authentication profile rotation details
- Respec describes a cooldown/expiry mechanism with "2× base × profile count" retries.
- OpenClaw retry logic in `pi-embedded-runner/run.ts` uses `BASE_RUN_RETRY_ITERATIONS` (24) + `RUN_RETRY_ITERATIONS_PER_PROFILE` (8) * profile count, scaled to `[MIN_RUN_RETRY_ITERATIONS=32, MAX_RUN_RETRY_ITERATIONS=160]`.
  - The formula differs from Respec's description; Respec should cite the actual constants.

## Confirmed matches
- Auth resolution chain (profile store → env vars → config → oauth) is present in `model-auth.ts`.
- Provider ID normalization (`z.ai` → `zai`, etc.) is handled in `model-selection.ts`.
